#!/bin/bash
# Remember chmod +x make.sh

argv=$1
usage()
{
    printf "Usage:\nCompiler:   $0 file.c\nConfigurer: sudo $0 -c\n"
}

#   Command line option to configure the memory randomizer.
while getopts ":c" flag; do
    case "${flag}" in
        c)
            if ! [ $(id -u) = 0 ]; then
                echo "-c option must be run as root."
                exit
            fi
            echo 0 > /proc/sys/kernel/randomize_va_space
            echo "Done"
            exit 1
            ;;
   esac
done

if [ $# -eq 0 ]; then
    usage
    exit 1
fi

# Remove the '.c' of the file.
output=${argv::-2}

gcc -fno-stack-protector -D_FORTIFY_SOURCE=0 -z norelro -z execstack $argv -o $output
